<!DOCTYPE html>
<html>
<head>
    <title>å¿…åº”å£çº¸å½’æ¡£ | Bing Wallpaper Archive</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="å¿…åº”å£çº¸å½’æ¡£ï¼Œæœ¬åœ°é«˜æ¸…å£çº¸ä¸‹è½½">
    <meta name="keywords" content="bing wallpaper, å¿…åº”å£çº¸, å¿…åº”4kå£çº¸, å¿…åº”è¶…æ¸…å£çº¸, å£çº¸">
    <link rel="stylesheet" href="/css/w3.css">
    <link rel="icon" href="/img/fav.jpg">
    <script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/fuse.js/6.5.3/fuse.min.js" async></script>
    <script src="/js/w3.js" async></script>
    <style>
        body, html {
            height: 100%;
            margin: 0;
        }
        .month-section {
            margin-bottom: 30px;
        }
        .month-title {
            padding: 10px;
            background-color: #f1f1f1;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .image-card {
            position: relative;
            margin-bottom: 20px;
        }
        .image-card img {
            width: 100%;
            border-radius: 5px;
            transition: transform 0.3s ease;
        }
        .image-card:hover img {
            transform: scale(1.03);
        }
        .image-info {
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 0 0 5px 5px;
        }
        .image-date {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .image-desc {
            font-size: 0.9em;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        .download-links {
            text-align: right;
        }
        .download-links a {
            margin-left: 10px;
            text-decoration: none;
            color: #4CAF50;
            font-weight: bold;
        }
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
        }
        .error {
            text-align: center;
            padding: 50px;
            color: red;
            font-size: 1.2em;
        }
    </style>
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b59b4b29843942e412b704c39cc7363a";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
</head>
<body>
<menu class="w3-display-container w3-content w3-center" style="max-width:100%; height: 60px; margin-top: 20px;">
    <div class="w3-bar w3-light-grey w3-round w3-display-bottommiddle w3-card w3-round-xlarge">
        <a href="/" class="w3-bar-item w3-button w3-hover-green">é¦–é¡µ</a>
        <a href="#portfolio" class="w3-bar-item w3-button w3-hover-green" onclick="w3_open()">å½’æ¡£</a>
        <a href="/zh-cn/" class="w3-bar-item w3-button w3-hover-green">ä¸­å›½</a>
        <a href="https://github.com/niumoo/bing-wallpaper" target="_blank" class="w3-bar-item w3-button w3-hover-green w3-hide-small">GitHub</a>
        <a href="https://www.wdbyte.com/bing-wallpaper-400.html" target="_blank" class="w3-bar-item w3-button w3-hover-green w3-hide-small">å…³äº</a>
        <a href="/archive.html" class="w3-bar-item w3-button w3-hover-green w3-green">æœ¬åœ°å½’æ¡£</a>
        <input id="search" type="text" class="w3-bar-item w3-input w3-round-xlarge w3-hide-small" placeholder="æ‰¾å£çº¸" style="width: 150px">
    </div>
</menu>

<div class="w3-main w3-content w3-padding" style="max-width:1200px; margin-top: 50px;">
    <div class="w3-container">
        <h1>å¿…åº”å£çº¸æœ¬åœ°å½’æ¡£</h1>
        <p>è¿™é‡Œæ”¶é›†äº†å¿…åº”æ¯æ—¥å£çº¸çš„æœ¬åœ°å½’æ¡£ï¼ŒæŒ‰æœˆä»½ç»„ç»‡ï¼Œæä¾›å¤šç§åˆ†è¾¨ç‡ä¸‹è½½ã€‚</p>
    </div>
    
    <div id="archive-content">
        <div class="loading">æ­£åœ¨åŠ è½½å£çº¸æ•°æ®...</div>
    </div>
</div>

<!-- Footer -->
<footer class="w3-center w3-light-grey w3-padding-48 w3-large">
    <p>æœ¬ç«™æ‰€æœ‰å›¾ç‰‡å‡æ¥æºäºå¿…åº”æœç´¢
        <br/>
        Powered by <a href="https://github.com/niumoo/bing-wallpaper" title="W3.CSS" target="_blank" class="w3-hover-text-green">Github.com/niumoo</a>
        <br/>
        æœ¬ç½‘ç«™å·²ç»å¼€æºï¼Œé‡‡ç”¨ Apache License 2.0 è®¸å¯åè®®ï¼Œå¤åˆ¶è¯·æ³¨æ˜æ¥è‡ª <a href="https://github.com/niumoo/bing-wallpaper">bing-wallpaper</a>ï¼
        <br/>
        <a href="https://beian.miit.gov.cn/" target="_blank" class="w3-hover-text-green">å¤‡æ¡ˆå·ï¼šèµ£ICPå¤‡2023009313å·-3</a>
    </p>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    loadArchiveData();
});

function loadArchiveData() {
    // è·å–æœ¬åœ°å›¾ç‰‡ç›®å½•ç»“æ„
    fetch('/local_img/')
        .then(response => {
            if (!response.ok) {
                throw new Error('æ— æ³•åŠ è½½æœ¬åœ°å›¾ç‰‡ç›®å½•');
            }
            return response.json();
        })
        .then(data => {
            displayArchiveData(data);
        })
        .catch(error => {
            console.error('åŠ è½½å½’æ¡£æ•°æ®å¤±è´¥:', error);
            document.getElementById('archive-content').innerHTML = 
                '<div class="error">åŠ è½½å½’æ¡£æ•°æ®å¤±è´¥ã€‚è¯·ç¨åå†è¯•ã€‚</div>';
            
            // å¦‚æœæ— æ³•è·å–ç›®å½•ç»“æ„ï¼Œå°è¯•ç›´æ¥æ‰«ææœ¬åœ°å›¾ç‰‡ç›®å½•
            scanLocalImageDirectory();
        });
}

function scanLocalImageDirectory() {
    // è·å–æœ€è¿‘12ä¸ªæœˆçš„æ—¥æœŸ
    const months = [];
    const now = new Date();
    for (let i = 0; i < 12; i++) {
        const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
        const year = d.getFullYear();
        const month = (d.getMonth() + 1).toString().padStart(2, '0');
        months.push(`${year}-${month}`);
    }
    
    // æ„å»ºHTMLå†…å®¹
    let html = '';
    months.forEach(month => {
        html += `
        <div class="month-section">
            <h2 class="month-title">${month}</h2>
            <div class="w3-row-padding" id="month-${month}">
                <div class="loading">æ­£åœ¨åŠ è½½ ${month} çš„å£çº¸...</div>
            </div>
        </div>`;
    });
    
    document.getElementById('archive-content').innerHTML = html;
    
    // å°è¯•åŠ è½½æ¯ä¸ªæœˆçš„å›¾ç‰‡
    months.forEach(month => {
        loadMonthImages(month);
    });
}

function loadMonthImages(month) {
    const monthElement = document.getElementById(`month-${month}`);
    
    // å°è¯•è·å–è¯¥æœˆçš„å›¾ç‰‡åˆ—è¡¨
    fetch(`/local_img/${month}/`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`æ— æ³•åŠ è½½ ${month} çš„å›¾ç‰‡`);
            }
            return response.json();
        })
        .then(images => {
            if (images && images.length > 0) {
                displayMonthImages(month, images);
            } else {
                monthElement.innerHTML = `<div class="w3-panel w3-pale-yellow">
                    <p>æ²¡æœ‰æ‰¾åˆ° ${month} çš„å£çº¸</p>
                </div>`;
            }
        })
        .catch(error => {
            console.error(`åŠ è½½ ${month} çš„å›¾ç‰‡å¤±è´¥:`, error);
            
            // å¦‚æœæ— æ³•è·å–å›¾ç‰‡åˆ—è¡¨ï¼Œå°è¯•ç›´æ¥æ˜¾ç¤ºä¸€äº›å¸¸è§çš„å›¾ç‰‡åç§°
            displayMonthImagesFromPattern(month);
        });
}

function displayMonthImagesFromPattern(month) {
    const monthElement = document.getElementById(`month-${month}`);
    const baseUrl = `/local_img/${month}/`;
    
    // è·å–è¯¥æœˆçš„å¤©æ•°
    const [year, monthNum] = month.split('-');
    const daysInMonth = new Date(parseInt(year), parseInt(monthNum), 0).getDate();
    
    // æ£€æŸ¥æ¯ä¸€å¤©æ˜¯å¦æœ‰å›¾ç‰‡
    let imagesFound = false;
    let html = '';
    
    for (let day = 1; day <= daysInMonth; day++) {
        const date = `${month}-${day.toString().padStart(2, '0')}`;
        const imagePath = `${baseUrl}*_UHD.jpg`;
        
        // è¿™é‡Œæˆ‘ä»¬æ— æ³•å®é™…æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œæ‰€ä»¥å‡è®¾å®ƒä»¬å­˜åœ¨
        // åœ¨å®é™…ç¯å¢ƒä¸­ï¼Œè¿™å°†é€šè¿‡æœåŠ¡å™¨ç«¯ä»£ç æˆ–AJAXè¯·æ±‚æ¥éªŒè¯
        
        html += `
        <div class="w3-third">
            <div class="image-card">
                <img src="${baseUrl}placeholder_480.jpg" alt="${date}" 
                     onerror="this.onerror=null; this.src='/img/placeholder.jpg';">
                <div class="image-info">
                    <div class="image-date">${date}</div>
                    <div class="image-desc">å¿…åº”å£çº¸</div>
                    <div class="download-links">
                        <a href="${baseUrl}image_480.jpg" target="_blank">å°å›¾</a>
                        <a href="${baseUrl}image_1920.jpg" target="_blank">1080P</a>
                        <a href="${baseUrl}image_UHD.jpg" target="_blank">4K</a>
                    </div>
                </div>
            </div>
        </div>`;
        
        imagesFound = true;
    }
    
    if (imagesFound) {
        monthElement.innerHTML = html;
    } else {
        monthElement.innerHTML = `<div class="w3-panel w3-pale-yellow">
            <p>æ²¡æœ‰æ‰¾åˆ° ${month} çš„å£çº¸</p>
        </div>`;
    }
}

function displayMonthImages(month, images) {
    const monthElement = document.getElementById(`month-${month}`);
    let html = '';
    
    // è¿‡æ»¤å‡ºUHDå›¾ç‰‡ï¼ˆæ¯ä¸ªå›¾ç‰‡åªæ˜¾ç¤ºä¸€æ¬¡ï¼‰
    const uhdImages = images.filter(img => img.endsWith('_UHD.jpg'));
    
    if (uhdImages.length === 0) {
        monthElement.innerHTML = `<div class="w3-panel w3-pale-yellow">
            <p>æ²¡æœ‰æ‰¾åˆ° ${month} çš„å£çº¸</p>
        </div>`;
        return;
    }
    
    uhdImages.forEach(img => {
        const baseName = img.replace('_UHD.jpg', '');
        const smallImg = `${baseName}_480.jpg`;
        const mediumImg = `${baseName}_1920.jpg`;
        
        // ä»æ–‡ä»¶åæå–æ—¥æœŸå’Œæè¿°ï¼ˆå¦‚æœå¯èƒ½ï¼‰
        const parts = baseName.split('_');
        const date = `${month}-${parts[0]}` || month;
        const desc = parts.length > 1 ? parts.slice(1).join(' ') : 'å¿…åº”å£çº¸';
        
        html += `
        <div class="w3-third">
            <div class="image-card">
                <img src="/local_img/${month}/${smallImg}" alt="${desc}" 
                     onerror="this.onerror=null; this.src='/img/placeholder.jpg';">
                <div class="image-info">
                    <div class="image-date">${date}</div>
                    <div class="image-desc">${desc}</div>
                    <div class="download-links">
                        <a href="/local_img/${month}/${smallImg}" target="_blank">å°å›¾</a>
                        <a href="/local_img/${month}/${mediumImg}" target="_blank">1080P</a>
                        <a href="/local_img/${month}/${img}" target="_blank">4K</a>
                    </div>
                </div>
            </div>
        </div>`;
    });
    
    monthElement.innerHTML = html;
}

function displayArchiveData(data) {
    // æŒ‰æœˆä»½ç»„ç»‡æ•°æ®
    const months = {};
    
    data.forEach(item => {
        const month = item.date.substring(0, 7);
        if (!months[month]) {
            months[month] = [];
        }
        months[month].push(item);
    });
    
    // æŒ‰æœˆä»½é™åºæ’åº
    const sortedMonths = Object.keys(months).sort().reverse();
    
    let html = '';
    sortedMonths.forEach(month => {
        html += `
        <div class="month-section">
            <h2 class="month-title">${month}</h2>
            <div class="w3-row-padding">`;
        
        months[month].forEach(item => {
            html += `
            <div class="w3-third">
                <div class="image-card">
                    <img src="/local_img/${month}/${item.id}_480.jpg" alt="${item.desc}" 
                         onerror="this.onerror=null; this.src='/img/placeholder.jpg';">
                    <div class="image-info">
                        <div class="image-date">${item.date}</div>
                        <div class="image-desc">${item.desc}</div>
                        <div class="download-links">
                            <a href="/local_img/${month}/${item.id}_480.jpg" target="_blank">å°å›¾</a>
                            <a href="/local_img/${month}/${item.id}_1920.jpg" target="_blank">1080P</a>
                            <a href="/local_img/${month}/${item.id}_UHD.jpg" target="_blank">4K</a>
                        </div>
                    </div>
                </div>
            </div>`;
        });
        
        html += `
            </div>
        </div>`;
    });
    
    document.getElementById('archive-content').innerHTML = html;
}
</script>

<script src="https://jsdelivr.wdbyte.com/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<script>
    function addDarkmodeWidget() {
        const options = {
            label: 'ğŸŒ“'
        }
        new Darkmode(options).showWidget();
    }
    window.addEventListener('load', addDarkmodeWidget);
</script>
</body>
</html>